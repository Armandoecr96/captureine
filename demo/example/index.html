<!doctype html>
<html>
  <head>
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
      <link rel="stylesheet" href="index.css" />
    <title>Capturine Demo</title>
  </head>
  <body>
    <div>
      <label>¿Es un INE?</label><br>
      <input id='isINE' type="checkbox" /> <br>
      <form id='ine-form-ABC' name='ine-form-ABC'>
        <p>Formulario pre-capcha</p> <br>
        <input id='ine' name='ine' placeholder='Clave de elector' /><br>
        <input id='nu' name='nu' placeholder='Número de emisión' /><br>
        <input id='ocr' name='ocr' placeholder='Número (OCR)' /><br>
        <input id='captcha' name='captcha' placeholder='Escribe la cadena de verificación' /><br>

        <button>Request Capcha</button>
      </form>
      <form id='ine-form-DE' action="">

      </form>
      <img id="demo-INE" src="" alt="">
      <img id='captcha-source' src="https://media.giphy.com/media/xTk9ZvMnbIiIew7IpW/giphy.gif" alt="" />
    </div>
  </body>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js'></script>
  <script>
    ;(function main () {
      const socket = io('http://localhost:3000')
      const form = document.querySelector('#ine-form-ABC')
      const captchaSource = document.querySelector('#captcha-source')
      const demoINE = document.querySelector('#demo-INE')

      form.addEventListener('submit', handleINEFormSubmit)

      function handleINEFormSubmit (e) {
        e.preventDefault()

        const ine = document.querySelector('#ine').value
        const nu = document.querySelector('#nu').value
        const ocr = document.querySelector('#ocr').value
        const captcha = document.querySelector('#captcha').value

        socket.emit('validateINEABC', { ine, nu, ocr, captcha }, (isValidINE) => {
          if (isValidINE) return alert('Fue valida')
          return alert('No fue valida')
        })
      }

      socket.emit('getCaptcha', (imageCaptcha, recoverIMG) => {
        const arrayBufferView = new Uint8Array(imageCaptcha)
        const blob = new Blob( [ arrayBufferView ], { type: "image/jpeg" } )
        const urlCreator = window.URL || window.webkitURL
        const imageUrl = urlCreator.createObjectURL(blob)
        captchaSource.src = imageUrl
        demoINE.src = recoverIMG
      })
    })()
  </script>
</html>